Thanks go to the following people for their patches:
@ghauerberg
@stuartfehr
